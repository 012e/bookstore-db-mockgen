-- Bang cac nhan vien
create table employees
(
    id              integer primary key generated by default as identity,
    first_name      varchar(255) not null,
    last_name       varchar(255) not null,
    email           varchar(255) not null,
    salary          money        not null check (salary >= 0::money),
    profile_picture text         not null,
    address         text         not null,
    phone_number    varchar(20)  not null,
    birthday        date         not null,
    is_manager      boolean      not null default false,
    gender          boolean      not null,
    password        varchar(255) not null
);

-- Bang cac nha cung cap
create table providers
(
    id      integer primary key generated by default as identity,
    name    varchar(255) not null,
    address varchar(255) not null
);

-- Cac vat pham
create table items
(
    id          integer primary key generated by default as identity,
    name        varchar(255) not null,
    image       text         not null,
    quantity    integer      not null check (quantity >= 0),
    description text,
    base_price  decimal      not null check (base_price >= 0),
    provider_id integer references providers (id) on delete cascade
);

create table customers
(
    id           integer primary key generated by default as identity,
    first_name   varchar(255) not null,
    last_name    varchar(255) not null,
    phone_number varchar(20)  not null,
    email        varchar(255) not null
);

-- Hoa don
create table invoices
(
    id          integer primary key generated always as identity,
    total       money                               not null check (total >= 0::money),
    employee_id integer                             not null references employees (id) on delete cascade,
    customer_id integer                             not null references customers (id) on delete cascade,
    created_at  timestamp default current_timestamp not null
);

-- Danh sach cac vat pham trong hoa don
create table invoices_items
(
    invoice_id integer not null references invoices (id) on delete cascade,
    item_id    integer not null references items (id) on delete cascade,
    quantity   integer not null check (quantity > 0),
    primary key (invoice_id, item_id)
);

create table tags
(
    id          integer primary key generated by default as identity,
    name        varchar(255) not null,
    description text
);

create table items_tags
(
    item_id integer references items (id) on delete cascade,
    tag_id  integer references tags (id) on delete cascade,
    primary key (item_id, tag_id)
);

create table price_types
(
    id   integer primary key generated by default as identity,
    name varchar(255) not null
);

create table item_prices
(
    id         integer primary key generated by default as identity,
    item_id    integer not null references items (id) on delete cascade,
    price_type text    not null,
    percentage decimal not null,
    ordering   integer not null,
    begin_date date    not null,
    end_date   date    not null
);

create table imports
(
    id          integer primary key generated by default as identity,
    provider_id integer                             not null references providers (id) on delete cascade,
    total_cost  money                               not null check (total_cost >= 0::money),
    created_at  timestamp default current_timestamp not null
);

create table import_items
(
    import_id integer not null references imports (id) on delete cascade,
    item_id   integer not null references items (id) on delete cascade,
    quantity  integer not null check (quantity >= 0),
    primary key (import_id, item_id)
);

-- Employees Table Indexes
create index idx_employees_email on employees (email);
create index idx_employees_phone_number on employees (phone_number);
create index idx_employees_is_manager on employees (is_manager);

-- Providers Table Index
create index idx_providers_address on providers (address);

-- Items Table Indexes
create index idx_items_name on items (name);
create index idx_items_quantity on items (quantity);
create index idx_items_base_price on items (base_price);
create index idx_items_provider_id on items (provider_id);

-- Customers Table Indexes
create index idx_customers_email on customers (email);
create index idx_customers_phone_number on customers (phone_number);

-- Invoices Table Indexes
create index idx_invoices_employee_id on invoices (employee_id);
create index idx_invoices_customer_id on invoices (customer_id);
create index idx_invoices_created_at on invoices (created_at);

-- Invoices_Items Table Indexes
create index idx_invoices_items_invoice_id on invoices_items (invoice_id);
create index idx_invoices_items_item_id on invoices_items (item_id);

-- Tags Table Index
create index idx_tags_name on tags (name);

-- Items_Tags Table Indexes
create index idx_items_tags_item_id on items_tags (item_id);
create index idx_items_tags_tag_id on items_tags (tag_id);

-- Item_Prices Table Indexes
create index idx_item_prices_item_id on item_prices (item_id);
create index idx_item_prices_price_type on item_prices (price_type);
create index idx_item_prices_begin_date on item_prices (begin_date);

-- Imports Table Indexes
create index idx_imports_provider_id on imports (provider_id);
create index idx_imports_created_at on imports (created_at);

-- Import_Items Table Indexes
create index idx_import_items_import_id on import_items (import_id);
create index idx_import_items_item_id on import_items (item_id);

